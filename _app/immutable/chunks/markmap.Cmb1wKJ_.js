import{s as X,a as M,p as Y,f as N,q as Z,g as F,d as b,j as y,l as C,r as $,n as S,t as ee,o as te,e as I,c as P,b as ne}from"./scheduler.CzL0JPbh.js";import{e as x,a as se,t as ie,g as z,S as re,P as le,l as ae,y as oe,b as fe}from"./common.C1_fZTma.js";import{S as ce,i as he}from"./index.CZ9WbNVy.js";import{d as ue}from"./debounce.1acgtFjJ.js";function D(l,t,n){const s=l.slice();return s[24]=t[n],s}function T(l){let t,n;return{c(){t=I("link"),this.h()},l(s){t=P(s,"LINK",{rel:!0,type:!0,href:!0}),this.h()},h(){y(t,"rel","stylesheet"),y(t,"type","text/css"),y(t,"href",n=l[24])},m(s,r){C(s,t,r)},p(s,r){r&8&&n!==(n=s[24])&&y(t,"href",n)},d(s){s&&b(t)}}}function J(l){let t,n;return{c(){t=I("div"),this.h()},l(s){t=P(s,"DIV",{class:!0,style:!0}),F(t).forEach(b),this.h()},h(){y(t,"class","markmap-highlight-area"),y(t,"style",n=`left:${l[4].x}px;top:${l[4].y}px;width:${l[4].width}px;height:${l[4].height}px;opacity:${l[4].opacity};`)},m(s,r){C(s,t,r)},p(s,r){r&16&&n!==(n=`left:${s[4].x}px;top:${s[4].y}px;width:${s[4].width}px;height:${s[4].height}px;opacity:${s[4].opacity};`)&&y(t,"style",n)},d(s){s&&b(t)}}}function me(l){let t,n,s,r,_,d,g=x(l[3].css||[]),o=[];for(let i=0;i<g.length;i+=1)o[i]=T(D(l,g,i));let f=l[4]&&J(l);return{c(){for(let i=0;i<o.length;i+=1)o[i].c();t=M(),f&&f.c(),n=M(),s=Y("svg"),this.h()},l(i){for(let c=0;c<o.length;c+=1)o[c].l(i);t=N(i),f&&f.l(i),n=N(i),s=Z(i,"svg",{xmlns:!0,class:!0,style:!0}),F(s).forEach(b),this.h()},h(){y(s,"xmlns","http://www.w3.org/2000/svg"),y(s,"class",r=`${l[2]} leading-none`),y(s,"style",l[1])},m(i,c){for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(i,c);C(i,t,c),f&&f.m(i,c),C(i,n,c),C(i,s,c),l[12](s),_||(d=$(s,"click",l[5]),_=!0)},p(i,[c]){if(c&8){g=x(i[3].css||[]);let h;for(h=0;h<g.length;h+=1){const p=D(i,g,h);o[h]?o[h].p(p,c):(o[h]=T(p),o[h].c(),o[h].m(t.parentNode,t))}for(;h<o.length;h+=1)o[h].d(1);o.length=g.length}i[4]?f?f.p(i,c):(f=J(i),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),c&4&&r!==(r=`${i[2]} leading-none`)&&y(s,"class",r),c&2&&y(s,"style",i[1])},i:S,o:S,d(i){i&&(b(t),b(n),b(s)),ee(o,i),f&&f.d(i),l[12](null),_=!1,d()}}}function de(l,t){let n=!1;return{promise:new Promise((r,_)=>{const d=performance.now(),g=()=>{const o=performance.now()-d,f=Math.min(o/l,1);if(t(f),f<1&&!n)return requestAnimationFrame(g);(n?_:r)()};requestAnimationFrame(g)}),abort:()=>{n=!0}}}function ge(l,t){return Array.isArray(l)&&Array.isArray(t)&&l.length===t.length&&l.every((n,s)=>n===t[s])}function ye(l,t,n){const s=se();let{mm:r}=t,{el:_=null}=t,{content:d=""}=t,{style:g=""}=t,{fit:o=!0}=t,{class:f=""}=t,{onReload:i=void 0}=t,{onOpenLink:c=void 0}=t,h=0,p;const k={};let A;function V(e){let a=e?{x:e.x,y:e.y,width:e.width,height:e.height,opacity:1}:void 0;if(n(4,A=a),a){const{abort:u,promise:m}=de(500,w=>{if(a!==A)return u();a.opacity=1-w,n(4,A=a)});m.finally(()=>{a===A&&n(4,A=void 0)})}}function B(e){var u;if(!r)return;const a=K(e-h);if(a){r.ensureView(a,{bottom:60});const m=(u=r.findElement(a))==null?void 0:u.g,w=m==null?void 0:m.getBoundingClientRect();V(w)}}const j=ue(()=>r.fit(),200);let O;function E(e,a=!1){var u;if(r&&(e!==O||a)){p=z().transform(e||""),h=p.contentLineOffset;const m=(u=p.frontmatter)==null?void 0:u.markmap,w=re(m),{extraJs:v,extraCss:L}=m||{};k.js&&!ge(k.js,v)?i==null||i():!k.js&&v&&(n(3,k.js=v,k),H()),n(3,k.css=L,k),r.setData(p.root,{...le,...w}),o&&r.fit(),O=e}}async function H(){await s,await ae(k.js.map(e=>({type:"script",data:{src:e}}))),E(d,!0)}function K(e){function a(m){var L,R,q;const[w,v]=((R=(L=m.payload)==null?void 0:L.lines)==null?void 0:R.split(",").map(W=>+W))||[];w>=0&&w<=e&&e<v&&(u=m),(q=m.children)==null||q.forEach(a)}let u;return p!=null&&p.root&&a(p.root),u}function G(e){var u;const a=(u=e.target)==null?void 0:u.closest("a");if(a){const m=a.getAttribute("href");(c==null?void 0:c(m))===!1&&e.preventDefault()}}async function Q(){await s;const e=[oe.tap(()=>{E(d,!0)}),z().hooks.retransform.tap(()=>{E(d,!0)})];return n(6,r=fe.create(_)),E(d),window.addEventListener("resize",j),()=>{var a;window.removeEventListener("resize",j),e.forEach(u=>{u()}),(a=r==null?void 0:r.destroy)==null||a.call(r),n(6,r=null)}}te(()=>{const e=Q();return()=>{e.then(a=>a())}});function U(e){ne[e?"unshift":"push"](()=>{_=e,n(0,_)})}return l.$$set=e=>{"mm"in e&&n(6,r=e.mm),"el"in e&&n(0,_=e.el),"content"in e&&n(7,d=e.content),"style"in e&&n(1,g=e.style),"fit"in e&&n(8,o=e.fit),"class"in e&&n(2,f=e.class),"onReload"in e&&n(9,i=e.onReload),"onOpenLink"in e&&n(10,c=e.onOpenLink)},l.$$.update=()=>{if(l.$$.dirty&128)try{E(d)}catch(e){console.error(e);const{message:a,stack:u}=e||{};ie("event","exception",{description:a+`
`+u})}l.$$.dirty&64&&r&&r.renderData()},[_,g,f,k,A,G,r,d,o,i,c,B,U]}class Ae extends ce{constructor(t){super(),he(this,t,ye,me,X,{mm:6,el:0,content:7,style:1,fit:8,class:2,onReload:9,onOpenLink:10,setCursor:11})}get setCursor(){return this.$$.ctx[11]}}export{Ae as M};
